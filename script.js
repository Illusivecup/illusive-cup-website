let database;let teamsManager;let securityManager;let matchManager;let votingSystem;let tournamentFormatManager;class ErrorHandler{static init(){window.addEventListener("error",this.handleError);window.addEventListener("unhandledrejection",this.handlePromiseRejection)}static handleError(error){console.error("üö® Global Error:",error);this.showNotification("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.","error")}static handlePromiseRejection(event){console.error("üö® Unhandled Promise Rejection:",event.reason);this.showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö","error")}static showNotification(message,type="error"){}}class TournamentFormatManager{constructor(database){this.database=database;this.currentFormat="with_groups";this.groupStages=["group","third_place","grand_final"];this.noGroupStages=["winners_round_1","winners_round_2","winners_round_3","winners_final","losers_round_1","losers_round_2","losers_round_3","losers_final","grand_final","third_place"]}async initialize(){await this.loadTournamentFormat();await this.setupFormatListeners();this.applyFormat()}async loadTournamentFormat(){try{const snapshot=await this.database.ref("tournamentFormat").once("value");if(snapshot.exists()){this.currentFormat=snapshot.val();console.log("üìã –ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞:",this.currentFormat)}}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç—É—Ä–Ω–∏—Ä–∞:",error)}}async setupFormatListeners(){this.database.ref("tournamentFormat").on("value",snapshot=>{if(snapshot.exists()){this.currentFormat=snapshot.val();console.log("üìã –û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞:",this.currentFormat);this.applyFormat();if(matchManager&&matchManager.updateMatchUI){matchManager.updateMatchUI()}}})}applyFormat(){const isGroupFormat=this.currentFormat==="with_groups";document.querySelectorAll(".group-format-item").forEach(item=>{item.classList.toggle("hidden",!isGroupFormat)});document.querySelectorAll(".no-group-format-item").forEach(item=>{item.classList.toggle("hidden",isGroupFormat)});const groupStageTab=document.querySelector('[data-tab="groupStageTab"]');const scheduleTab=document.querySelector('[data-tab="scheduleTab"]');const rpofTab=document.querySelector('[data-tab="rpofTab"]');if(groupStageTab){groupStageTab.classList.toggle("hidden",!isGroupFormat)}if(scheduleTab){scheduleTab.classList.toggle("hidden",!isGroupFormat)}if(rpofTab){rpofTab.classList.toggle("hidden",isGroupFormat)}this.updateStageSelects();console.log("üéØ –ü—Ä–∏–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç:",isGroupFormat?"–° –≥—Ä—É–ø–ø–æ–π":"–ë–µ–∑ –≥—Ä—É–ø–ø—ã")}updateStageSelects(){const isGroupFormat=this.currentFormat==="with_groups";const newMatchStageSelect=document.getElementById("newMatchStage");const editMatchStageSelect=document.getElementById("editMatchStage");if(newMatchStageSelect){newMatchStageSelect.innerHTML=this.getStageOptions(isGroupFormat)}if(editMatchStageSelect){editMatchStageSelect.innerHTML=this.getStageOptions(isGroupFormat)}}getStageOptions(isGroupFormat){if(isGroupFormat){return`
                <option value="group">–ì—Ä—É–ø–ø–æ–≤–æ–π —ç—Ç–∞–ø</option>
                <option value="third_place">–ú–∞—Ç—á –∑–∞ 3 –º–µ—Å—Ç–æ</option>
                <option value="grand_final">–ì—Ä–∞–Ω–¥ —Ñ–∏–Ω–∞–ª</option>
            `}else{return`
                <option value="winners_round_1">Winners Round 1</option>
                <option value="winners_round_2">Winners Round 2</option>
                <option value="winners_round_3">Winners Round 3</option>
                <option value="winners_final">Winners Final</option>
                <option value="losers_round_1">Losers Round 1</option>
                <option value="losers_round_2">Losers Round 2</option>
                <option value="losers_round_3">Losers Round 3</option>
                <option value="losers_final">Losers Final</option>
                <option value="grand_final">Grand Final</option>
                <option value="third_place">–ú–∞—Ç—á –∑–∞ 3 –º–µ—Å—Ç–æ</option>
            `}}updateUI(){const formatSelect=document.getElementById("tournamentFormat");if(formatSelect){formatSelect.value=this.currentFormat}this.updateStageSelects()}async setTournamentFormat(format){try{await this.database.ref("tournamentFormat").set(format);this.currentFormat=format;this.applyFormat();console.log("‚úÖ –§–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω:",format);return true}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç—É—Ä–Ω–∏—Ä–∞:",error);return false}}getCurrentFormat(){return this.currentFormat}isGroupFormat(){return this.currentFormat==="with_groups"}getStageName(stage){const stages={group:"–ì—Ä—É–ø–ø–æ–≤–æ–π —ç—Ç–∞–ø",third_place:"–ú–∞—Ç—á –∑–∞ 3 –º–µ—Å—Ç–æ",grand_final:"–ì—Ä–∞–Ω–¥ —Ñ–∏–Ω–∞–ª",winners_round_1:"Winners Round 1",winners_round_2:"Winners Round 2",winners_round_3:"Winners Round 3",winners_final:"Winners Final",losers_round_1:"Losers Round 1",losers_round_2:"Losers Round 2",losers_round_3:"Losers Round 3",losers_final:"Losers Final"};return stages[stage]||stage}}class SecurityManager{constructor(){this.EDITOR_PASSWORD=window.ADMIN_CONFIG?.editorPassword;this.isAuthenticated=false;console.log("üîê SecurityManager —Å–æ–∑–¥–∞–Ω")}init(){console.log("üîê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SecurityManager...");this.checkRequiredElements();this.checkExistingSession();this.setupEventListeners();console.log("‚úÖ SecurityManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")}checkRequiredElements(){const requiredElements=["adminBtn","authModal","adminPanel","confirmAuth","cancelAuth","closeAuthModal","closeAdminPanel","editorPassword"];requiredElements.forEach(id=>{const element=document.getElementById(id);console.log(`üîç ${id}:`,element?"‚úÖ –ù–∞–π–¥–µ–Ω":"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω")})}setupEventListeners(){console.log("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ SecurityManager...");const adminBtn=document.getElementById("adminBtn");if(adminBtn){adminBtn.addEventListener("click",e=>{e.preventDefault();console.log("üñ±Ô∏è –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ –Ω–∞–∂–∞—Ç–∞!");this.handleAdminButtonClick()});console.log("‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω")}else{console.error("‚ùå –≠–ª–µ–º–µ–Ω—Ç adminBtn –Ω–µ –Ω–∞–π–¥–µ–Ω")}this.setupAuthModalListeners()}setupAuthModalListeners(){const confirmAuth=document.getElementById("confirmAuth");const cancelAuth=document.getElementById("cancelAuth");const closeAuthModal=document.getElementById("closeAuthModal");const closeAdminPanel=document.getElementById("closeAdminPanel");const editorPassword=document.getElementById("editorPassword");if(confirmAuth){confirmAuth.addEventListener("click",()=>{this.handleAuthConfirm()})}if(cancelAuth){cancelAuth.addEventListener("click",()=>{this.hideAuthModal()})}if(closeAuthModal){closeAuthModal.addEventListener("click",()=>{this.hideAuthModal()})}if(closeAdminPanel){closeAdminPanel.addEventListener("click",()=>{this.hideAdminPanel()})}if(editorPassword){editorPassword.addEventListener("keypress",e=>{if(e.key==="Enter"){this.handleAuthConfirm()}})}console.log("‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã")}handleAdminButtonClick(){console.log("üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –∞–¥–º–∏–Ω–∫–∏, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:",this.isAuthenticated);if(this.isAuthenticated){this.showAdminPanel()}else{this.showAuthModal()}}async handleAuthConfirm(){console.log("üîê –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...");const passwordInput=document.getElementById("editorPassword");const password=passwordInput.value.trim();if(!password){alert("‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å");return}const isValid=await this.authenticate(password);if(isValid){this.isAuthenticated=true;this.startSession();this.hideAuthModal();this.showAdminPanel();updateConnectionStatus(true);alert("‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!")}else{alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");passwordInput.value="";passwordInput.focus()}}async authenticate(password){await new Promise(resolve=>setTimeout(resolve,500));return password===this.EDITOR_PASSWORD}startSession(){const sessionData={authenticated:true,timestamp:Date.now()};localStorage.setItem("editor_session",JSON.stringify(sessionData));console.log("üíæ –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage")}checkExistingSession(){try{const sessionData=localStorage.getItem("editor_session");if(!sessionData)return;const data=JSON.parse(sessionData);const sessionAge=Date.now()-data.timestamp;const maxAge=8*60*60*1e3;if(data.authenticated&&sessionAge<maxAge){this.isAuthenticated=true;console.log("‚úÖ –°–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞")}else{this.clearSession()}}catch(error){this.clearSession()}}clearSession(){localStorage.removeItem("editor_session");this.isAuthenticated=false;console.log("üóëÔ∏è –°–µ—Å—Å–∏—è –æ—á–∏—â–µ–Ω–∞")}showAuthModal(){console.log("ü™ü –ü–æ–∫–∞–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");const modal=document.getElementById("authModal");if(modal){modal.classList.remove("hidden");const passwordInput=document.getElementById("editorPassword");if(passwordInput){passwordInput.focus()}}}hideAuthModal(){console.log("ü™ü –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");const modal=document.getElementById("authModal");if(modal){modal.classList.add("hidden");const passwordInput=document.getElementById("editorPassword");if(passwordInput){passwordInput.value=""}}}showAdminPanel(){console.log("üñ•Ô∏è –ü–æ–∫–∞–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏");const panel=document.getElementById("adminPanel");if(panel){panel.classList.remove("hidden");if(window.updateAdminTeamsList){updateAdminTeamsList()}populateVoteMatchSelect();setupHolidayThemeToggle()}}hideAdminPanel(){console.log("üñ•Ô∏è –°–∫—Ä—ã—Ç–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏");const panel=document.getElementById("adminPanel");if(panel){panel.classList.add("hidden")}updateConnectionStatus(false)}}class TeamsManager{constructor(database){this.database=database;this.teams={}}async initialize(){await this.setupListeners()}async setupListeners(){return new Promise(resolve=>{this.database.ref("teams").on("value",snapshot=>{this.handleTeamsUpdate(snapshot.val());resolve()})})}handleTeamsUpdate(teamsData){this.teams=teamsData||{};console.log("üì• –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥:",this.teams);updateConnectionStatus(true);this.updateUI()}updateUI(){updateTeamsDropdown();updateAdminTeamsList();const appState=getAppState();if(appState.currentDisplayedTeamId){showSingleTeamCard(appState.currentDisplayedTeamId)}}calculateTeamMMR(players){if(!players||players.length===0)return 0;const totalMMR=players.reduce((sum,player)=>{return sum+(parseInt(player.mmr)||0)},0);return Math.round(totalMMR/players.length)}async updateTeam(teamId,teamData){teamData.mmr=this.calculateTeamMMR(teamData.players);teamData.updatedAt=Date.now();await this.database.ref(`teams/${teamId}`).update(teamData);return teamId}async createTeam(teamId,teamData){teamData.mmr=this.calculateTeamMMR(teamData.players);teamData.createdAt=Date.now();teamData.updatedAt=Date.now();await this.database.ref(`teams/${teamId}`).set(teamData);return teamId}async deleteTeam(teamId){if(!confirm("‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–∞–Ω–¥—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")){return}try{await this.database.ref(`teams/${teamId}`).remove();delete this.teams[teamId];console.log("‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –±–∞–∑—ã:",teamId);closeEditTeamModal();this.updateUI();if(matchManager&&matchManager.updateMatchUI){matchManager.updateMatchUI()}alert("‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!")}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã:",error);alert("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã")}}getTeam(teamId){return this.teams[teamId]}getAllTeams(){return{...this.teams}}getAllTeams(includeHidden=false){if(includeHidden&&window.HiddenTeamsManager){return window.HiddenTeamsManager.getAllTeamsWithHidden(this.teams)}return{...this.teams}}isTeamHidden(teamId){return window.HiddenTeamsManager?window.HiddenTeamsManager.isHiddenTeam(teamId):false}}class MatchManager{constructor(database){this.database=database;this.matches={};this.noGroupMatches={}}async initialize(){await this.setupMatchListeners()}async setupMatchListeners(){this.database.ref("matches").on("value",snapshot=>{this.matches=snapshot.val()||{};console.log("üì• –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –º–∞—Ç—á–µ–π (—Å –≥—Ä—É–ø–ø–æ–π):",this.matches);this.updateMatchUI()});this.database.ref("noGroupMatches").on("value",snapshot=>{this.noGroupMatches=snapshot.val()||{};console.log("üì• –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –º–∞—Ç—á–µ–π (–±–µ–∑ –≥—Ä—É–ø–ø—ã):",this.noGroupMatches);this.updateMatchUI()})}updateMatchUI(){const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;if(isGroupFormat){this.updateGroupStageTable();this.updatePlayoffMatches();this.updateScheduleLists()}else{this.updateNoGroupScheduleLists();this.updateDoubleEliminationBracket()}}getCurrentMatches(){const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;return isGroupFormat?this.matches:this.noGroupMatches}updateNoGroupScheduleLists(){const upcomingContainer=document.getElementById("upcomingMatchesNoGroup");const completedContainer=document.getElementById("completedMatchesNoGroup");if(!upcomingContainer||!completedContainer)return;const matches=this.noGroupMatches;const upcoming=Object.entries(matches).filter(([matchId,match])=>!this.isMatchCompleted(match)).sort(([,a],[,b])=>(a.timestamp||0)-(b.timestamp||0));const completed=Object.entries(matches).filter(([matchId,match])=>this.isMatchCompleted(match)).sort(([,a],[,b])=>(b.timestamp||0)-(a.timestamp||0));upcomingContainer.innerHTML=upcoming.map(([matchId,match])=>this.createEnhancedScheduleMatchCard(match,false,matchId,false)).join("")||'<div class="no-data">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π</div>';completedContainer.innerHTML=completed.map(([matchId,match])=>this.createEnhancedScheduleMatchCard(match,true,matchId,false)).join("")||'<div class="no-data">–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π</div>'}updateDoubleEliminationBracket(){const container=document.getElementById("playoffGridContent");if(!container)return;const matches=this.noGroupMatches;const winnersBracket={winners_round_1:"Winners Round 1",winners_round_2:"Winners Round 2",winners_round_3:"Winners Round 3",winners_final:"Winners Final"};const losersBracket={losers_round_1:"Losers Round 1",losers_round_2:"Losers Round 2",losers_round_3:"Losers Round 3",losers_final:"Losers Final"};const finals={grand_final:"Grand Final",third_place:"Match for 3rd Place"};let content=`
            <div class="double-elimination-container">
                <div class="brackets-section">
                    <div class="winners-bracket">
                        <h3>üèÜ Winners Bracket</h3>
        `;Object.entries(winnersBracket).forEach(([stageKey,stageName])=>{const stageMatches=Object.entries(matches).filter(([matchId,match])=>match.stage===stageKey).sort(([,a],[,b])=>(a.timestamp||0)-(b.timestamp||0));if(stageMatches.length>0){content+=`
                    <div class="bracket-stage">
                        <h4>${stageName}</h4>
                        <div class="stage-matches">
                            ${stageMatches.map(([matchId,match])=>this.createDoubleEliminationMatchCard(match,matchId,"winners")).join("")}
                        </div>
                    </div>
                `}});content+=`
                    </div>
                    
                    <div class="losers-bracket">
                        <h3>üíÄ Losers Bracket</h3>
        `;Object.entries(losersBracket).forEach(([stageKey,stageName])=>{const stageMatches=Object.entries(matches).filter(([matchId,match])=>match.stage===stageKey).sort(([,a],[,b])=>(a.timestamp||0)-(b.timestamp||0));if(stageMatches.length>0){content+=`
                    <div class="bracket-stage">
                        <h4>${stageName}</h4>
                        <div class="stage-matches">
                            ${stageMatches.map(([matchId,match])=>this.createDoubleEliminationMatchCard(match,matchId,"losers")).join("")}
                        </div>
                    </div>
                `}});content+=`
                    </div>
                </div>
                
                <div class="finals-section">
                    <h3>üéØ Finals</h3>
        `;Object.entries(finals).forEach(([stageKey,stageName])=>{const stageMatches=Object.entries(matches).filter(([matchId,match])=>match.stage===stageKey).sort(([,a],[,b])=>(a.timestamp||0)-(b.timestamp||0));if(stageMatches.length>0){content+=`
                    <div class="final-stage">
                        <h4>${stageName}</h4>
                        <div class="stage-matches">
                            ${stageMatches.map(([matchId,match])=>this.createDoubleEliminationMatchCard(match,matchId,"final")).join("")}
                        </div>
                    </div>
                `}});content+=`
                </div>
            </div>
        `;container.innerHTML=content||'<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Ç—á–∞—Ö –ø–ª–µ–π-–æ—Ñ—Ñ</div>'}createDoubleEliminationMatchCard(match,matchId,bracketType){const isCompleted=this.isMatchCompleted(match);const winner=this.getMatchWinner(match);const team1Class=winner==="team1"?"winner":winner==="team2"?"loser":"";const team2Class=winner==="team2"?"winner":winner==="team1"?"loser":"";const teams=teamsManager.getAllTeams(true);const team1Name=teams[match.team1Id]?.name||match.team1Name||"–ö–æ–º–∞–Ω–¥–∞ 1";const team2Name=teams[match.team2Id]?.name||match.team2Name||"–ö–æ–º–∞–Ω–¥–∞ 2";const isHiddenTeam1=teamsManager.isTeamHidden(match.team1Id);const isHiddenTeam2=teamsManager.isTeamHidden(match.team2Id);let bracketClass="";if(bracketType==="winners")bracketClass="winners-match";else if(bracketType==="losers")bracketClass="losers-match";else if(bracketType==="final")bracketClass="final-match";if(isHiddenTeam1||isHiddenTeam2){bracketClass+=" has-hidden-teams"}return`
        <div class="double-elimination-match ${bracketClass}" data-match-id="${matchId}">
            <div class="match-teams">
                <div class="team-name ${team1Class}">
                    ${team1Name} ${isHiddenTeam1?"‚è≥":""}
                </div>
                <div class="vs">
                    ${isCompleted?`<div class="match-score">${match.score1||0}:${match.score2||0}</div>`:'<div class="vs-text">VS</div>'}
                </div>
                <div class="team-name ${team2Class}">
                    ${team2Name} ${isHiddenTeam2?"‚è≥":""}
                </div>
            </div>
            <div class="match-info">
                <span class="match-time">${match.time||"–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ"}</span>
                <span class="match-format">${this.getFormatName(match.format)}</span>
            </div>
            ${isCompleted?'<div class="match-status completed">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</div>':'<div class="match-status upcoming">‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è</div>'}
        </div>
    `}async createDoubleEliminationBracket(){const teams=teamsManager.getAllTeams();const teamIds=Object.keys(teams);if(teamIds.length!==8){alert("‚ùå –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Double Elimination —Å–µ—Ç–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è 8 –∫–æ–º–∞–Ω–¥");return}try{await this.database.ref("noGroupMatches").remove();this.noGroupMatches={}}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –º–∞—Ç—á–µ–π:",error)}const bracketMatches=[{stage:"winners_round_1",team1:0,team2:1,format:"bo3"},{stage:"winners_round_1",team1:2,team2:3,format:"bo3"},{stage:"winners_round_1",team1:4,team2:5,format:"bo3"},{stage:"winners_round_1",team1:6,team2:7,format:"bo3"},{stage:"winners_round_2",team1:"winner_wr1_1",team2:"winner_wr1_2",format:"bo3"},{stage:"winners_round_2",team1:"winner_wr1_3",team2:"winner_wr1_4",format:"bo3"},{stage:"winners_round_3",team1:"winner_wr2_1",team2:"winner_wr2_2",format:"bo3"},{stage:"losers_round_1",team1:"loser_wr1_1",team2:"loser_wr1_2",format:"bo3"},{stage:"losers_round_1",team1:"loser_wr1_3",team2:"loser_wr1_4",format:"bo3"},{stage:"losers_round_2",team1:"loser_wr2_1",team2:"winner_lr1_1",format:"bo3"},{stage:"losers_round_2",team1:"loser_wr2_2",team2:"winner_lr1_2",format:"bo3"},{stage:"losers_round_3",team1:"winner_lr2_1",team2:"winner_lr2_2",format:"bo3"},{stage:"winners_final",team1:"winner_wr3_1",team2:"winner_lr3_1",format:"bo5"},{stage:"losers_final",team1:"loser_wf_1",team2:"winner_lr3_1",format:"bo5"},{stage:"grand_final",team1:"winner_wf_1",team2:"winner_lf_1",format:"bo5"},{stage:"third_place",team1:"loser_wf_1",team2:"loser_lf_1",format:"bo3"}];const baseTime=Date.now();for(let i=0;i<4;i++){const matchTemplate=bracketMatches[i];const team1Id=teamIds[matchTemplate.team1];const team2Id=teamIds[matchTemplate.team2];const matchData={team1Id:team1Id,team2Id:team2Id,team1Name:teams[team1Id].name,team2Name:teams[team2Id].name,time:new Date(baseTime+i*2*60*60*1e3).toLocaleString("ru-RU"),timestamp:baseTime+i*2*60*60*1e3,stage:matchTemplate.stage,format:matchTemplate.format,score1:0,score2:0,createdAt:Date.now()};await this.createMatch(matchData)}alert("‚úÖ Double Elimination —Å–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –î–æ–±–∞–≤–ª–µ–Ω—ã –º–∞—Ç—á–∏ Winners Round 1");this.updateDoubleEliminationBracket()}isMatchCompleted(match){if(!match.format){match.format="bo1"}const score1=parseInt(match.score1)||0;const score2=parseInt(match.score2)||0;switch(match.format){case"bo1":return score1>=1||score2>=1;case"bo3":return score1>=2||score2>=2;case"bo5":return score1>=3||score2>=3;default:return score1>=1||score2>=1}}getRequiredWins(format){switch(format){case"bo1":return 1;case"bo3":return 2;case"bo5":return 3;default:return 1}}getFormatName(format){const formats={bo1:"Bo1",bo3:"Bo3",bo5:"Bo5"};return formats[format]||"Bo1"}getMatchWinner(match){if(!this.isMatchCompleted(match))return null;const requiredWins=this.getRequiredWins(match.format);const score1=parseInt(match.score1)||0;const score2=parseInt(match.score2)||0;if(score1>=requiredWins)return"team1";if(score2>=requiredWins)return"team2";return null}updateGroupStageTable(){const container=document.getElementById("groupStageContainer");if(!container)return;const groupMatches=Object.values(this.matches).filter(match=>match.stage==="group");const standings=this.calculateStandings(groupMatches);container.innerHTML=this.createEnhancedGroupStageTable(standings)}calculateStandings(matches){const standings={};const teams=teamsManager?teamsManager.getAllTeams():{};Object.keys(teams).forEach(teamId=>{const team=teams[teamId];if(team&&team.name){standings[teamId]={teamId:teamId,teamName:team.name,played:0,wins:0,losses:0,points:0}}});matches.forEach(match=>{if(!this.isMatchCompleted(match))return;const team1Exists=teams[match.team1Id]&&teams[match.team1Id].name;const team2Exists=teams[match.team2Id]&&teams[match.team2Id].name;if(!team1Exists||!team2Exists)return;if(!standings[match.team1Id]){standings[match.team1Id]={teamId:match.team1Id,teamName:match.team1Name,played:0,wins:0,losses:0,points:0}}if(!standings[match.team2Id]){standings[match.team2Id]={teamId:match.team2Id,teamName:match.team2Name,played:0,wins:0,losses:0,points:0}}standings[match.team1Id].played++;standings[match.team2Id].played++;const winner=this.getMatchWinner(match);if(winner==="team1"){standings[match.team1Id].wins++;standings[match.team1Id].points+=3;standings[match.team2Id].losses++}else if(winner==="team2"){standings[match.team2Id].wins++;standings[match.team2Id].points+=3;standings[match.team1Id].losses++}});const validStandings=Object.values(standings).filter(team=>team&&team.teamName);return validStandings.sort((a,b)=>{if(b.points!==a.points)return b.points-a.points;if(b.wins!==a.wins)return b.wins-a.wins;return a.losses-b.losses})}createEnhancedGroupStageTable(standings){if(standings.length===0){return'<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–∞—Ç—á–∞—Ö –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —ç—Ç–∞–ø–∞</div>'}const points=standings.map(team=>team.points);const minPoints=Math.min(...points);const maxPoints=Math.max(...points);return`
            <div class="standings-table">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                            <th>–ò</th>
                            <th>–í</th>
                            <th>–ü</th>
                            <th>–û</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${standings.map((team,index)=>{let rowClass="middle";if(team.points===maxPoints&&maxPoints!==minPoints){rowClass="champion"}else if(team.points===minPoints&&maxPoints!==minPoints){rowClass="relegation"}return`
                                <tr class="${rowClass}">
                                    <td>${index+1}</td>
                                    <td><strong>${team.teamName}</strong></td>
                                    <td>${team.played}</td>
                                    <td>${team.wins}</td>
                                    <td>${team.losses}</td>
                                    <td>${team.points}</td>
                                </tr>
                            `}).join("")}
                    </tbody>
                </table>
            </div>
        `}updatePlayoffMatches(){this.updateThirdPlaceMatch();this.updateGrandFinal();this.updateWinnerSection()}updateThirdPlaceMatch(){const container=document.getElementById("thirdPlaceMatch");if(!container)return;const thirdPlaceMatch=Object.values(this.matches).find(match=>match.stage==="third_place");if(thirdPlaceMatch){container.innerHTML=this.createPlayoffMatchCard(thirdPlaceMatch)}else{container.innerHTML='<div class="no-match">–ú–∞—Ç—á –∑–∞ 3 –º–µ—Å—Ç–æ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>'}}updateGrandFinal(){const container=document.getElementById("grandFinalMatch");if(!container)return;const grandFinal=Object.values(this.matches).find(match=>match.stage==="grand_final");if(grandFinal){container.innerHTML=this.createPlayoffMatchCard(grandFinal)}else{container.innerHTML='<div class="no-match">–ì—Ä–∞–Ω–¥—Ñ–∏–Ω–∞–ª –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω</div>'}}updateWinnerSection(){const container=document.getElementById("winnerSection");if(!container)return;const grandFinal=Object.values(this.matches).find(match=>match.stage==="grand_final"&&this.isMatchCompleted(match));if(grandFinal){const winner=this.getMatchWinner(grandFinal);const winnerName=winner==="team1"?grandFinal.team1Name:grandFinal.team2Name;container.innerHTML=`
                <div class="winner-content">
                    <div class="winner-icon">üèÜ</div>
                    <div class="winner-name">${winnerName}</div>
                    <div class="winner-subtitle">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å Illusive Cup 2025</div>
                </div>
            `}else{container.innerHTML='<div class="no-match">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</div>'}}createPlayoffMatchCard(match){const isCompleted=this.isMatchCompleted(match);const currentFormat=match.format||"bo1";const winner=this.getMatchWinner(match);const team1Class=winner==="team1"?"winner":winner==="team2"?"loser":"";const team2Class=winner==="team2"?"winner":winner==="team1"?"loser":"";return`
            <div class="playoff-match-content">
                <div class="playoff-team ${team1Class}">
                    ${match.team1Name}
                </div>
                ${isCompleted?`
                    <div class="playoff-score">${match.score1||0} : ${match.score2||0}</div>
                `:`
                    <div class="playoff-vs">VS</div>
                `}
                <div class="playoff-team ${team2Class}">
                    ${match.team2Name}
                </div>
                ${match.time?`<div class="match-time">${match.time}</div>`:""}
                <div class="match-format">${this.getFormatName(currentFormat)}</div>
            </div>
        `}updateScheduleLists(){this.updateUpcomingMatches();this.updateCompletedMatches();this.updateNoGroupScheduleLists()}updateUpcomingMatches(){const container=document.getElementById("upcomingMatches");if(!container)return;const upcoming=Object.entries(this.matches).filter(([matchId,match])=>!this.isMatchCompleted(match)).sort(([,a],[,b])=>(a.timestamp||0)-(b.timestamp||0));container.innerHTML=upcoming.map(([matchId,match])=>this.createEnhancedScheduleMatchCard(match,false,matchId,true)).join("")||'<div class="no-data">–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π</div>'}updateCompletedMatches(){const container=document.getElementById("completedMatches");if(!container)return;const completed=Object.entries(this.matches).filter(([matchId,match])=>this.isMatchCompleted(match)).sort(([,a],[,b])=>(b.timestamp||0)-(a.timestamp||0));container.innerHTML=completed.map(([matchId,match])=>this.createEnhancedScheduleMatchCard(match,true,matchId,true)).join("")||'<div class="no-data">–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π</div>'}createEnhancedScheduleMatchCard(match,isCompleted=false,matchId="",isGroupFormat=true){const showScore=match.score1!==undefined&&match.score2!==undefined;const teams=teamsManager?teamsManager.getAllTeams(true):{};const team1Name=teams[match.team1Id]?.name||match.team1Name||"–ö–æ–º–∞–Ω–¥–∞ 1";const team2Name=teams[match.team2Id]?.name||match.team2Name||"–ö–æ–º–∞–Ω–¥–∞ 2";const team1Exists=teams[match.team1Id]&&teams[match.team1Id].name;const team2Exists=teams[match.team2Id]&&teams[match.team2Id].name;const isHiddenTeam1=teamsManager.isTeamHidden(match.team1Id);const isHiddenTeam2=teamsManager.isTeamHidden(match.team2Id);const winner=this.getMatchWinner(match);const team1Class=winner==="team1"?"winner":winner==="team2"?"loser":"";const team2Class=winner==="team2"?"winner":winner==="team1"?"loser":"";let matchClass="match-card";const stageName=tournamentFormatManager?tournamentFormatManager.getStageName(match.stage):match.stage;if(match.stage==="grand_final"){matchClass+=" grand-final"}else if(match.stage==="third_place"){matchClass+=" third-place"}else if(["winners_round_1","winners_round_2","winners_round_3","winners_final"].includes(match.stage)){matchClass+=" playoff-stage"}else if(["losers_round_1","losers_round_2","losers_round_3","losers_final"].includes(match.stage)){matchClass+=" lower-bracket"}else{matchClass+=" group-stage"}if(isCompleted){matchClass+=" completed"}if(isHiddenTeam1||isHiddenTeam2){matchClass+=" has-hidden-teams"}if(!team1Exists||!team2Exists){return`
            <div class="${matchClass} deleted" data-match-id="${matchId}">
                <div class="match-time">${match.time||"–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ"}</div>
                <div class="match-teams">
                    <div class="team-name large deleted">${team1Exists?team1Name:"–ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞"}</div>
                    <div class="vs">vs</div>
                    <div class="team-name large deleted">${team2Exists?team2Name:"–ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞"}</div>
                </div>
                <div class="match-stage">${stageName}</div>
                <div class="match-format">${this.getFormatName(match.format)}</div>
                <div class="match-status">üóëÔ∏è –ö–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–µ–Ω–∞</div>
            </div>
        `}const winnerIcon=winner?"üèÜ":"";const hiddenIcon="‚è≥";return`
        <div class="${matchClass}" data-match-id="${matchId}">
            <div class="match-time">${match.time||"–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ"}</div>
            <div class="match-teams">
                <div class="team-name large ${team1Class}">
                    ${team1Name} ${winner==="team1"?winnerIcon:""} ${isHiddenTeam1?hiddenIcon:""}
                </div>
                <div class="vs">vs</div>
                <div class="team-name large ${team2Class}">
                    ${team2Name} ${winner==="team2"?winnerIcon:""} ${isHiddenTeam2?hiddenIcon:""}
                </div>
            </div>
            ${showScore?createEnhancedProgressBar(match):""}
            <div class="match-stage">${stageName}</div>
            <div class="match-format">${this.getFormatName(match.format)}</div>
            ${isCompleted?'<div class="match-status">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</div>':'<div class="match-status">‚è≥ –û–∂–∏–¥–∞–µ—Ç—Å—è</div>'}
            ${isHiddenTeam1||isHiddenTeam2?'<div class="match-note">‚ö†Ô∏è –°–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∞–Ω–¥—ã-–∑–∞–≥–ª—É—à–∫–∏</div>':""}
        </div>
    `}async createMatch(matchData){const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;const matchId=`match_${Date.now()}`;matchData.createdAt=Date.now();matchData.updatedAt=Date.now();if(!matchData.format){matchData.format="bo1"}const dbPath=isGroupFormat?"matches":"noGroupMatches";await this.database.ref(`${dbPath}/${matchId}`).set(matchData);console.log("‚úÖ –ú–∞—Ç—á —Å–æ–∑–¥–∞–Ω –≤ –±–∞–∑–µ:",matchId,"–§–æ—Ä–º–∞—Ç:",isGroupFormat?"—Å –≥—Ä—É–ø–ø–æ–π":"–±–µ–∑ –≥—Ä—É–ø–ø—ã");return matchId}async updateMatch(matchId,matchData){const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;const dbPath=isGroupFormat?"matches":"noGroupMatches";matchData.updatedAt=Date.now();if(isGroupFormat){if(this.matches[matchId]){this.matches[matchId]={...this.matches[matchId],...matchData}}}else{if(this.noGroupMatches[matchId]){this.noGroupMatches[matchId]={...this.noGroupMatches[matchId],...matchData}}}await this.database.ref(`${dbPath}/${matchId}`).update(matchData);console.log("‚úÖ –ú–∞—Ç—á –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –±–∞–∑–µ –∏ –ª–æ–∫–∞–ª—å–Ω–æ:",matchId)}async deleteMatch(matchId){if(!confirm("‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")){return}try{const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;const dbPath=isGroupFormat?"matches":"noGroupMatches";await this.database.ref(`${dbPath}/${matchId}`).remove();if(isGroupFormat){delete this.matches[matchId]}else{delete this.noGroupMatches[matchId]}console.log("‚úÖ –ú–∞—Ç—á —É–¥–∞–ª–µ–Ω –∏–∑ –±–∞–∑—ã:",matchId);closeEditMatchResultModal();this.updateMatchUI();alert("‚úÖ –ú–∞—Ç—á —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!")}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞:",error);alert("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ç—á–∞")}}async setMatchResult(matchId,score1,score2,format="bo1"){const match=this.getMatch(matchId);if(!match)return;const updateData={score1:parseInt(score1),score2:parseInt(score2),format:format,updatedAt:Date.now()};await this.updateMatch(matchId,updateData);this.updateMatchUI()}getMatch(matchId){const isGroupFormat=tournamentFormatManager?tournamentFormatManager.isGroupFormat():true;return isGroupFormat?this.matches[matchId]:this.noGroupMatches[matchId]}}function createEnhancedProgressBar(match){const requiredWins=matchManager.getRequiredWins(match.format);const score1=parseInt(match.score1)||0;const score2=parseInt(match.score2)||0;const totalGames=score1+score2;const team1Percentage=totalGames>0?score1/totalGames*100:50;const team2Percentage=totalGames>0?score2/totalGames*100:50;const winner=matchManager.getMatchWinner(match);const team1Class=winner==="team1"?"winner":"";const team2Class=winner==="team2"?"winner":"";return`
        <div class="match-progress">
            <div class="progress-bar-container">
                <div class="progress-bar-track">
                    <div class="progress-team progress-team-1 ${team1Class}" 
                         style="width: ${team1Percentage}%">
                    </div>
                    <div class="progress-team progress-team-2 ${team2Class}" 
                         style="width: ${team2Percentage}%">
                    </div>
                    <div class="progress-score-center">${score1} : ${score2}</div>
                    ${totalGames>0?`<div class="progress-divider" style="left: ${team1Percentage}%"></div>`:""}
                </div>
            </div>
            <div class="progress-text">
                ${winner?"üèÜ –ú–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω":`–î–æ –ø–æ–±–µ–¥—ã: ${requiredWins} –ø–æ–±–µ–¥`}
            </div>
        </div>
    `}class VotingSystem{constructor(database){this.database=database;this.votes={}}async initialize(){await this.setupVoteListeners()}async setupVoteListeners(){this.database.ref("audienceAwards/votes").on("value",snapshot=>{this.votes=snapshot.val()||{};console.log("üì• –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≥–æ–ª–æ—Å–æ–≤:",this.votes);this.updateVoteResults();updateAudienceAwardsDisplay()})}updateVoteResults(){const resultsContainer=document.getElementById("voteResultsContent");if(!resultsContainer)return;if(Object.keys(this.votes).length===0){resultsContainer.innerHTML='<div class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏</div>';return}const matchVotes={};Object.values(this.votes).forEach(vote=>{if(!matchVotes[vote.matchId]){matchVotes[vote.matchId]={matchInfo:vote.matchInfo,players:{}}}vote.selectedPlayers.forEach(player=>{const playerKey=`${player.teamId}_${player.playerName}`;if(!matchVotes[vote.matchId].players[playerKey]){matchVotes[vote.matchId].players[playerKey]={...player,votes:0}}matchVotes[vote.matchId].players[playerKey].votes++})});resultsContainer.innerHTML=Object.entries(matchVotes).map(([matchId,matchData])=>{const topPlayers=Object.values(matchData.players).sort((a,b)=>b.votes-a.votes).slice(0,5);return`
                <div class="vote-result-card">
                    <div class="vote-match-header">
                        <h4>${matchData.matchInfo.team1Name} vs ${matchData.matchInfo.team2Name}</h4>
                        <div class="vote-match-score">${matchData.matchInfo.score}</div>
                        <div class="vote-actions">
                            <button class="edit-vote-btn" onclick="editVote('${matchId}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="delete-vote-btn" onclick="deleteVote('${matchId}')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                    <div class="vote-players">
                        ${topPlayers.map(player=>`
                            <div class="vote-player-result ${player.votes===Math.max(...topPlayers.map(p=>p.votes))?"top-voted":""}">
                                <span class="player-name">${player.playerName}</span>
                                <span class="player-team">(${player.teamName})</span>
                                <span class="vote-count">${player.votes} –≥–æ–ª–æ—Å–æ–≤</span>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `}).join("")}async submitVote(matchId,selectedPlayers){const voteId=`vote_${Date.now()}`;const match=matchManager.getMatch(matchId);const voteData={matchId:matchId,matchInfo:{team1Name:match.team1Name,team2Name:match.team2Name,score:`${match.score1||0}:${match.score2||0}`,time:match.time||(new Date).toLocaleString("ru-RU"),stage:match.stage||"group",format:match.format||"bo1"},selectedPlayers:selectedPlayers,timestamp:Date.now()};await this.database.ref(`audienceAwards/votes/${voteId}`).set(voteData);return voteId}async deleteVote(matchId){if(!confirm("‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≥–æ–ª–æ—Å–∞ –∑–∞ —ç—Ç–æ—Ç –º–∞—Ç—á? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")){return}try{const votesToDelete=[];Object.entries(this.votes).forEach(([voteId,vote])=>{if(vote.matchId===matchId){votesToDelete.push(voteId)}});for(const voteId of votesToDelete){await this.database.ref(`audienceAwards/votes/${voteId}`).remove()}console.log("‚úÖ –ì–æ–ª–æ—Å–∞ —É–¥–∞–ª–µ–Ω—ã:",votesToDelete.length);alert(`‚úÖ –£–¥–∞–ª–µ–Ω–æ ${votesToDelete.length} –≥–æ–ª–æ—Å–æ–≤ –∑–∞ –º–∞—Ç—á`)}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤:",error);alert("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤")}}async editVote(matchId){showEditVoteModal(matchId)}}function populateVoteMatchSelect(){const select=document.getElementById("voteMatchSelect");if(!select||!matchManager)return;select.innerHTML='<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á --</option>';const matches=matchManager.getCurrentMatches();const teams=teamsManager.getAllTeams();Object.entries(matches).forEach(([matchId,match])=>{const team1Exists=teams[match.team1Id]&&teams[match.team1Id].name;const team2Exists=teams[match.team2Id]&&teams[match.team2Id].name;if(team1Exists&&team2Exists){const option=document.createElement("option");option.value=matchId;option.textContent=`${match.team1Name} vs ${match.team2Name} - ${match.time||"–í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ"} - ${match.score1||0}:${match.score2||0}`;select.appendChild(option)}})}function showVotingModal(matchId){const match=matchManager.getMatch(matchId);if(!match)return;const teams=teamsManager.getAllTeams();const team1=teams[match.team1Id];const team2=teams[match.team2Id];if(!team1||!team2){alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥");return}window.currentVotingMatchId=matchId;const matchInfo=document.getElementById("votingMatchInfo");matchInfo.className="match-info compact";matchInfo.innerHTML=`
        <div class="match-teams">
            <div class="team-name large">${match.team1Name}</div>
            <div class="vs">vs</div>
            <div class="team-name large">${match.team2Name}</div>
        </div>
        <div class="match-score">${match.score1||0} : ${match.score2||0}</div>
        <div class="match-stage">${tournamentFormatManager?tournamentFormatManager.getStageName(match.stage):match.stage} ‚Ä¢ ${matchManager.getFormatName(match.format)}</div>
    `;const team1Column=document.getElementById("team1Voting");const team2Column=document.getElementById("team2Voting");team1Column.className="voting-column compact";team2Column.className="voting-column compact";team1Column.innerHTML=`
        <h3>${match.team1Name}</h3>
        ${team1.players.map((player,index)=>`
            <div class="player-vote-item compact" data-team="team1" data-player-index="${index}">
                <div class="player-mmr">MMR: ${player.mmr||0}</div>
                <div class="player-vote-name" data-mmr="${player.mmr||0}">${player.name}</div>
                <div class="player-vote-role">${player.role}</div>
                <div class="reason-input-container compact hidden">
                    <textarea class="reason-input compact" placeholder="–ü–æ—á–µ–º—É –≤—ã –≤—ã–±—Ä–∞–ª–∏ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
                </div>
            </div>
        `).join("")}
    `;team2Column.innerHTML=`
        <h3>${match.team2Name}</h3>
        ${team2.players.map((player,index)=>`
            <div class="player-vote-item compact" data-team="team2" data-player-index="${index}">
                <div class="player-mmr">MMR: ${player.mmr||0}</div>
                <div class="player-vote-name" data-mmr="${player.mmr||0}">${player.name}</div>
                <div class="player-vote-role">${player.role}</div>
                <div class="reason-input-container compact hidden">
                    <textarea class="reason-input compact" placeholder="–ü–æ—á–µ–º—É –≤—ã –≤—ã–±—Ä–∞–ª–∏ —ç—Ç–æ–≥–æ –∏–≥—Ä–æ–∫–∞? (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="2"></textarea>
                </div>
            </div>
        `).join("")}
    `;document.querySelectorAll(".player-vote-name").forEach(playerName=>{playerName.addEventListener("mouseenter",function(){const mmr=this.getAttribute("data-mmr");const originalText=this.textContent;this.setAttribute("data-original-text",originalText);this.textContent=`MMR: ${mmr}`});playerName.addEventListener("mouseleave",function(){const originalText=this.getAttribute("data-original-text");if(originalText){this.textContent=originalText}})});document.querySelectorAll(".player-vote-item").forEach(item=>{item.addEventListener("click",function(e){if(e.target.classList.contains("reason-input"))return;const wasSelected=this.classList.contains("selected");if(!wasSelected){this.classList.add("selected");this.querySelector(".reason-input-container").classList.remove("hidden");this.querySelector(".reason-input").focus()}else{this.classList.remove("selected");this.querySelector(".reason-input-container").classList.add("hidden");this.querySelector(".reason-input").value=""}});let tapTimer;item.addEventListener("touchstart",function(e){e.stopPropagation();tapTimer=setTimeout(()=>{const playerName=this.querySelector(".player-vote-name");if(playerName){const mmr=playerName.getAttribute("data-mmr");const originalText=playerName.textContent;playerName.setAttribute("data-original-text",originalText);playerName.textContent=`MMR: ${mmr}`}},500)});item.addEventListener("touchend",function(e){e.stopPropagation();clearTimeout(tapTimer)});item.addEventListener("touchmove",function(e){e.stopPropagation();clearTimeout(tapTimer)})});const cancelBtn=document.getElementById("cancelVote");if(cancelBtn){cancelBtn.className="voting-cancel-btn";cancelBtn.innerHTML="‚ùå –û—Ç–º–µ–Ω–∞"}document.getElementById("votingModal").classList.remove("hidden")}async function submitVote(){const selectedPlayers=document.querySelectorAll(".player-vote-item.selected");const matchId=window.currentVotingMatchId;if(selectedPlayers.length===0){alert("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞");return}const match=matchManager.getMatch(matchId);const teams=teamsManager.getAllTeams();const votes=Array.from(selectedPlayers).map(player=>{const team=player.getAttribute("data-team");const playerIndex=parseInt(player.getAttribute("data-player-index"));const teamData=team==="team1"?teams[match.team1Id]:teams[match.team2Id];const playerData=teamData.players[playerIndex];const reason=player.querySelector(".reason-input")?.value.trim()||"";return{teamId:team==="team1"?match.team1Id:match.team2Id,teamName:team==="team1"?match.team1Name:match.team2Name,playerName:playerData.name,playerRole:playerData.role,reason:reason}});try{const submitBtn=document.getElementById("submitVote");submitBtn.disabled=true;submitBtn.textContent="‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...";await votingSystem.submitVote(matchId,votes);closeVotingModal();alert("‚úÖ –í–∞—à –≥–æ–ª–æ—Å —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");updateAudienceAwardsDisplay()}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–∞:",error);alert("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–∞");const submitBtn=document.getElementById("submitVote");submitBtn.disabled=false;submitBtn.textContent="‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å"}}function closeVotingModal(){document.getElementById("votingModal").classList.add("hidden");window.currentVotingMatchId=null;document.querySelectorAll(".player-vote-item").forEach(item=>{item.classList.remove("selected");const playerName=item.querySelector(".player-vote-name");const originalText=playerName.getAttribute("data-original-text");if(originalText){playerName.textContent=originalText}item.querySelector(".reason-input-container").classList.add("hidden");item.querySelector(".reason-input").value=""});const submitBtn=document.getElementById("submitVote");submitBtn.disabled=false;submitBtn.textContent="‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å"}function showEditVoteModal(matchId){const match=matchManager.getMatch(matchId);if(!match)return;const existingVotes=Object.values(votingSystem.votes).filter(vote=>vote.matchId===matchId);const matchInfo=document.getElementById("editVoteInfo");matchInfo.innerHTML=`
        <div class="match-teams">
            <div class="team-name large">${match.team1Name}</div>
            <div class="vs">vs</div>
            <div class="team-name large">${match.team2Name}</div>
        </div>
        <div class="match-score">${match.score1||0} : ${match.score2||0}</div>
        <div class="total-votes">–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ${existingVotes.length}</div>
    `;const votesList=document.getElementById("existingVotesList");if(existingVotes.length===0){votesList.innerHTML='<div class="no-data">–ù–µ—Ç –≥–æ–ª–æ—Å–æ–≤ –∑–∞ —ç—Ç–æ—Ç –º–∞—Ç—á</div>'}else{votesList.innerHTML=existingVotes.map((vote,index)=>`
            <div class="existing-vote-item">
                <div class="vote-header">
                    <strong>–ì–æ–ª–æ—Å #${index+1}</strong>
                    <span class="vote-time">${new Date(vote.timestamp).toLocaleString("ru-RU")}</span>
                </div>
                <div class="vote-players">
                    ${vote.selectedPlayers.map(player=>`
                        <div class="voted-player">
                            <span class="player-name">${player.playerName}</span>
                            <span class="player-team">(${player.teamName})</span>
                            ${player.reason?`<div class="player-reason">–ü—Ä–∏—á–∏–Ω–∞: ${player.reason}</div>`:""}
                        </div>
                    `).join("")}
                </div>
            </div>
        `).join("")}document.getElementById("deleteAllVotesBtn").onclick=()=>{votingSystem.deleteVote(matchId);closeEditVoteModal()};document.getElementById("editVoteModal").classList.remove("hidden")}function closeEditVoteModal(){document.getElementById("editVoteModal").classList.add("hidden")}window.deleteVote=function(matchId){if(votingSystem){votingSystem.deleteVote(matchId)}};window.editVote=function(matchId){if(votingSystem){votingSystem.editVote(matchId)}};async function updateAudienceAwardsDisplay(){const container=document.getElementById("audienceAwardsContent");if(!container)return;try{const snapshot=await database.ref("audienceAwards/votes").once("value");const votes=snapshot.val()||{};if(Object.keys(votes).length===0){container.innerHTML='<div class="no-data">–ü–æ–∫–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤ –æ—Ç –∑—Ä–∏—Ç–µ–ª–µ–π</div>';return}const playerVotes={};Object.values(votes).forEach(vote=>{const matchInfo=vote.matchInfo;vote.selectedPlayers.forEach(player=>{const playerKey=`${player.teamName}_${player.playerName}`;if(!playerVotes[playerKey]){playerVotes[playerKey]={...player,votes:0,reasons:[],matches:new Set}}playerVotes[playerKey].votes++;if(player.reason){playerVotes[playerKey].reasons.push({reason:player.reason,matchInfo:matchInfo})}playerVotes[playerKey].matches.add(JSON.stringify(matchInfo))})});const sortedPlayers=Object.values(playerVotes).sort((a,b)=>b.votes-a.votes);const groupedPlayers=[];let currentVotes=-1;let currentGroup=[];let currentPlace=1;sortedPlayers.forEach((player,index)=>{if(player.votes!==currentVotes){if(currentGroup.length>0){groupedPlayers.push({place:currentPlace,players:currentGroup,votes:currentVotes});currentPlace+=currentGroup.length}currentVotes=player.votes;currentGroup=[player]}else{currentGroup.push(player)}});if(currentGroup.length>0){groupedPlayers.push({place:currentPlace,players:currentGroup,votes:currentVotes})}const topPlayers=[];let placeCounter=1;for(const group of groupedPlayers){for(const player of group.players){if(topPlayers.length<10){topPlayers.push({...player,place:group.place,displayPlace:group.players.length>1?`${group.place}-${group.place+group.players.length-1}`:group.place.toString()})}}placeCounter+=group.players.length;if(topPlayers.length>=10)break}container.innerHTML=`
            <div class="award-match-card">
                <div class="award-match-header">
                    <h3>üèÜ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –º–Ω–µ–Ω–∏—é –∑—Ä–∏—Ç–µ–ª–µ–π</h3>
                    <div class="award-match-time">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${(new Date).toLocaleString("ru-RU")}</div>
                </div>
                <div class="award-players">
                    ${topPlayers.map((player,index)=>{const isTopThree=player.place<=3;const isHonorable=player.place>3&&player.place<=6;const cardClass=isTopThree?"top-player":isHonorable?"honorable-player":"regular-player";const matchesArray=Array.from(player.matches).map(matchStr=>JSON.parse(matchStr));return`
                            <div class="award-player-card ${cardClass}">
                                <div class="player-award-name">${player.playerName}</div>
                                <div class="player-award-role">${player.playerRole}</div>
                                <div class="player-award-team">${player.teamName}</div>
                                <div class="player-award-votes">‚ù§Ô∏è ${player.votes} –≥–æ–ª–æ—Å–æ–≤</div>
                                <div class="player-award-place">–ú–µ—Å—Ç–æ: ${player.displayPlace}</div>
                                ${isTopThree?`<div class="player-award-badge">üèÖ –¢–æ–ø ${player.place}</div>`:""}
                                ${isHonorable?`<div class="player-honorable-badge">‚≠ê –í—ã–¥–∞—é—â–∏–π—Å—è</div>`:""}
                                ${player.reasons&&player.reasons.length>0?`
                                    <div class="player-reasons">
                                        <strong>–ü—Ä–∏—á–∏–Ω—ã –≤—ã–±–æ—Ä–∞:</strong>
                                        <ul>
                                            ${player.reasons.slice(0,3).map(reasonData=>reasonData.reason?`
                                                    <li>
                                                        <div class="reason-text">${reasonData.reason}</div>
                                                        <div class="reason-match-info">
                                                            üìÖ ${reasonData.matchInfo.team1Name} vs ${reasonData.matchInfo.team2Name} 
                                                            ${reasonData.matchInfo.time?`‚Ä¢ ${reasonData.matchInfo.time}`:""}
                                                            ${reasonData.matchInfo.score?`‚Ä¢ ${reasonData.matchInfo.score}`:""}
                                                            ${reasonData.matchInfo.stage?`‚Ä¢ ${tournamentFormatManager?tournamentFormatManager.getStageName(reasonData.matchInfo.stage):reasonData.matchInfo.stage}`:""}
                                                            ${reasonData.matchInfo.format?`‚Ä¢ ${matchManager.getFormatName(reasonData.matchInfo.format)}`:""}
                                                        </div>
                                                    </li>
                                                `:"").join("")}
                                            ${player.reasons.length>3?`<li>...–∏ –µ—â–µ ${player.reasons.length-3} –ø—Ä–∏—á–∏–Ω</li>`:""}
                                        </ul>
                                    </div>
                                `:""}
                                ${matchesArray.length>0?`
                                    <div class="player-matches">
                                        <strong>–û—Ç–ª–∏—á–∏–ª—Å—è –≤–æ –≤—Å—Ç—Ä–µ—á–∞—Ö:</strong>
                                        <div class="matches-list">
                                            ${matchesArray.slice(0,2).map(match=>`
                                                <div class="match-info-small">
                                                    ${match.team1Name} vs ${match.team2Name}
                                                    ${match.time?`‚Ä¢ ${match.time}`:""}
                                                    ${match.score?`‚Ä¢ ${match.score}`:""}
                                                </div>
                                            `).join("")}
                                            ${matchesArray.length>2?`<div class="more-matches">...–∏ –µ—â–µ ${matchesArray.length-2} –º–∞—Ç—á–µ–π</div>`:""}
                                        </div>
                                    </div>
                                `:""}
                            </div>
                        `}).join("")}
                </div>
            </div>
        `}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤:",error);container.innerHTML='<div class="no-data">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–æ–ª–æ—Å–æ–≤</div>'}}function showEditMatchTimeModal(matchId){const modal=document.getElementById("editMatchResultModal");const matchInfo=document.getElementById("editMatchInfo");const score1Input=document.getElementById("editMatchScore1");const score2Input=document.getElementById("editMatchScore2");const formatSelect=document.getElementById("editMatchFormat");const stageSelect=document.getElementById("editMatchStage");if(!modal||!matchInfo||!score1Input||!score2Input||!matchManager)return;const match=matchManager.getMatch(matchId);if(!match)return;const teams=teamsManager?teamsManager.getAllTeams(true):{};const team1Exists=teams[match.team1Id]&&teams[match.team1Id].name;const team2Exists=teams[match.team2Id]&&teams[match.team2Id].name;const isHiddenTeam1=teamsManager.isTeamHidden(match.team1Id);const isHiddenTeam2=teamsManager.isTeamHidden(match.team2Id);if(!team1Exists||!team2Exists){alert("‚ùå –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç—á —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏");return}matchInfo.innerHTML=`
        <div class="match-teams">
            <div class="form-group">
                <label>–ö–æ–º–∞–Ω–¥–∞ 1:</label>
                <select id="editMatchTeam1" class="form-input">
                    ${Object.entries(teams).map(([id,team])=>{const isHidden=teamsManager.isTeamHidden(id);return`<option value="${id}" ${match.team1Id===id?"selected":""}>
                            ${team.name} ${isHidden?"‚è≥":""}
                        </option>`}).join("")}
                </select>
            </div>
            <div class="vs">vs</div>
            <div class="form-group">
                <label>–ö–æ–º–∞–Ω–¥–∞ 2:</label>
                <select id="editMatchTeam2" class="form-input">
                    ${Object.entries(teams).map(([id,team])=>{const isHidden=teamsManager.isTeamHidden(id);return`<option value="${id}" ${match.team2Id===id?"selected":""}>
                            ${team.name} ${isHidden?"‚è≥":""}
                        </option>`}).join("")}
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>–í—Ä–µ–º—è –º–∞—Ç—á–∞:</label>
            <input type="datetime-local" id="editMatchTime" class="form-input" value="${getDateTimeForInput(match.timestamp)}">
        </div>
        <div class="match-stage">${tournamentFormatManager?tournamentFormatManager.getStageName(match.stage):match.stage}</div>
        ${isHiddenTeam1||isHiddenTeam2?'<div class="match-warning">‚ö†Ô∏è –ú–∞—Ç—á —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–∞–Ω–¥—ã-–∑–∞–≥–ª—É—à–∫–∏</div>':""}
    `;score1Input.value=match.score1||0;score2Input.value=match.score2||0;if(formatSelect){formatSelect.innerHTML=`
            <option value="bo1" ${match.format==="bo1"?"selected":""}>Bo1 (1 –ø–æ–±–µ–¥–∞)</option>
            <option value="bo3" ${match.format==="bo3"?"selected":""}>Bo3 (2 –ø–æ–±–µ–¥—ã)</option>
            <option value="bo5" ${match.format==="bo5"?"selected":""}>Bo5 (3 –ø–æ–±–µ–¥—ã)</option>
        `}if(stageSelect&&tournamentFormatManager){const isGroupFormat=tournamentFormatManager.isGroupFormat();stageSelect.innerHTML=tournamentFormatManager.getStageOptions(isGroupFormat);stageSelect.value=match.stage}const deleteMatchBtn=document.getElementById("deleteMatchBtn");if(deleteMatchBtn){deleteMatchBtn.onclick=()=>window.deleteMatch(matchId)}appState.currentEditingMatchId=matchId;modal.classList.remove("hidden")}async function saveMatchResultWithTime(){const matchId=appState.currentEditingMatchId;const score1Input=document.getElementById("editMatchScore1");const score2Input=document.getElementById("editMatchScore2");const formatSelect=document.getElementById("editMatchFormat");const stageSelect=document.getElementById("editMatchStage");const timeInput=document.getElementById("editMatchTime");const team1Select=document.getElementById("editMatchTeam1");const team2Select=document.getElementById("editMatchTeam2");if(!matchId||!score1Input||!score2Input||!matchManager||!team1Select||!team2Select)return;const score1=parseInt(score1Input.value);const score2=parseInt(score2Input.value);const format=formatSelect?formatSelect.value:"bo1";const stage=stageSelect?stageSelect.value:"group";const timeValue=timeInput?timeInput.value:"";const newTeam1Id=team1Select.value;const newTeam2Id=team2Select.value;if(!newTeam1Id||!newTeam2Id){alert("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –∫–æ–º–∞–Ω–¥—ã");return}if(newTeam1Id===newTeam2Id){alert("‚ùå –ö–æ–º–∞–Ω–¥—ã –Ω–µ –º–æ–≥—É—Ç –∏–≥—Ä–∞—Ç—å —Å–∞–º–∏ —Å —Å–æ–±–æ–π");return}if(isNaN(score1)||isNaN(score2)){alert("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–µ—Ç–∞");return}if(score1<0||score2<0){alert("‚ùå –°—á–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º");return}const requiredWins=matchManager.getRequiredWins(format);if(score1>requiredWins||score2>requiredWins){alert(`‚ùå –°—á–µ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å ${requiredWins} –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∞ ${matchManager.getFormatName(format)}`);return}if(score1>=requiredWins&&score2>=requiredWins||score1===requiredWins&&score2===requiredWins){alert(`‚ùå –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å ${requiredWins} –ø–æ–±–µ–¥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${matchManager.getFormatName(format)}`);return}try{const teams=teamsManager.getAllTeams(true);const team1Name=teams[newTeam1Id]?.name||"–ö–æ–º–∞–Ω–¥–∞ 1";const team2Name=teams[newTeam2Id]?.name||"–ö–æ–º–∞–Ω–¥–∞ 2";const updateData={team1Id:newTeam1Id,team2Id:newTeam2Id,team1Name:team1Name,team2Name:team2Name,score1:parseInt(score1),score2:parseInt(score2),format:format,stage:stage,updatedAt:Date.now()};if(timeValue){const newTimestamp=new Date(timeValue).getTime();const newTime=new Date(timeValue).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});updateData.timestamp=newTimestamp;updateData.time=newTime}await matchManager.updateMatch(matchId,updateData);closeEditMatchResultModal();alert("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–æ–º–∞–Ω–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!");if(matchManager.updateMatchUI){matchManager.updateMatchUI()}}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:",error);alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞")}}function getDateTimeForInput(timestamp){if(!timestamp)return"";const date=new Date(timestamp);const year=date.getFullYear();const month=String(date.getMonth()+1).padStart(2,"0");const day=String(date.getDate()).padStart(2,"0");const hours=String(date.getHours()).padStart(2,"0");const minutes=String(date.getMinutes()).padStart(2,"0");return`${year}-${month}-${day}T${hours}:${minutes}`}window.deleteMatch=function(matchId){if(!matchId||!matchManager)return;if(!confirm("‚ùå –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.")){return}matchManager.deleteMatch(matchId)};function closeEditMatchResultModal(){const modal=document.getElementById("editMatchResultModal");if(modal){modal.classList.add("hidden");appState.currentEditingMatchId=null}}const appState={currentEditingTeamId:null,currentDisplayedTeamId:null,currentEditingMatchId:null};function getAppState(){return appState}function toggleDropdown(){const dropdown=document.querySelector(".dropdown");if(dropdown){dropdown.classList.toggle("active")}}function closeAllDropdowns(){document.querySelectorAll(".dropdown").forEach(dropdown=>{dropdown.classList.remove("active")})}function showSection(sectionName){document.querySelectorAll(".content-section").forEach(section=>{section.classList.add("hidden")});const targetSection=document.getElementById(`${sectionName}Content`);if(targetSection){targetSection.classList.remove("hidden")}appState.currentDisplayedTeamId=null}function updateTeamsDropdown(){const dropdown=document.getElementById("teamsDropdown");if(!dropdown||!teamsManager)return;const teams=teamsManager.getAllTeams();dropdown.innerHTML="";Object.keys(teams).forEach(teamId=>{const team=teams[teamId];const link=document.createElement("a");link.href="#";link.textContent=team.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";link.addEventListener("click",e=>{e.preventDefault();showSingleTeamCard(teamId)});dropdown.appendChild(link)})}function showSingleTeamCard(teamId){const container=document.getElementById("singleTeamCard");if(!container||!teamsManager)return;const team=teamsManager.getTeam(teamId);if(!team)return;const card=createTeamCard(teamId,team);container.innerHTML="";container.appendChild(card);appState.currentDisplayedTeamId=teamId;hideAllSections();document.getElementById("teamsContent").classList.remove("hidden");closeAllDropdowns()}function hideAllSections(){document.querySelectorAll(".content-section").forEach(section=>{section.classList.add("hidden")})}function createTeamCard(teamId,team){const card=document.createElement("div");card.className="team-visiting-card";card.setAttribute("data-team-id",teamId);const players=team.players||[];const playersHTML=players.map((player,index)=>`
        <div class="player-card-bublas">
            <div class="player-role-bublas">${player.role||"–ò–≥—Ä–æ–∫"}</div>
            <div class="player-name-bublas" data-mmr="${player.mmr||"0"}">
                ${player.name||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}
            </div>
        </div>
    `).join("");const editButton=securityManager&&securityManager.isAuthenticated?`<button class="edit-team-btn" onclick="editTeam('${teamId}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>`:"";card.innerHTML=`
        <div class="card-header">
            <div class="header-highlight"></div>
            <div class="team-name-bublas">${team.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</div>
            <div class="team-subtitle">${team.slogan||"–ì–æ—Ç–æ–≤—ã –∫ –ø–æ–±–µ–¥–µ!"}</div>
        </div>
        <div class="team-card-content">
            <div class="players-section-bublas">
                <div class="section-title-bublas">–°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</div>
                <div class="player-grid-bublas">
                    ${playersHTML}
                </div>
            </div>
            <div class="stats-section-bublas">
                <div class="mmr-display-bublas">
                    <div class="mmr-label-bublas">–°—Ä–µ–¥–Ω–∏–π MMR</div>
                    <div class="mmr-value-bublas">${team.mmr||"0"}</div>
                </div>
                <div class="tournament-section-bublas">
                    <div class="tournament-text-bublas">–∏–≥—Ä–∞–µ–º –Ω–∞</div>
                    <div class="tournament-badge-bublas">Illusive Cup III</div>
                </div>
            </div>
        </div>
        <div class="team-footer-bublas">
            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ —Ç—É—Ä–Ω–∏—Ä–µ
            ${editButton}
        </div>
    `;card.querySelectorAll(".player-name-bublas").forEach(playerName=>{playerName.addEventListener("mouseenter",function(){const mmr=this.getAttribute("data-mmr");this.setAttribute("data-original-text",this.textContent);this.textContent=`MMR: ${mmr}`});playerName.addEventListener("mouseleave",function(){const originalText=this.getAttribute("data-original-text");if(originalText){this.textContent=originalText}})});return card}function closeAllModals(){document.querySelectorAll(".modal").forEach(modal=>{modal.classList.add("hidden")})}function closeEditTeamModal(){document.getElementById("editTeamModal").classList.add("hidden");appState.currentEditingTeamId=null}function openAdminTab(tabName){document.querySelectorAll(".tab-btn").forEach(btn=>{btn.classList.remove("active")});document.querySelectorAll(".tab-pane").forEach(pane=>{pane.classList.remove("active")});const targetBtn=document.querySelector(`[data-tab="${tabName}"]`);const targetPane=document.getElementById(tabName);if(targetBtn)targetBtn.classList.add("active");if(targetPane)targetPane.classList.add("active")}function loadRulesContent(){const rulesContainer=document.getElementById("rulesContainer");rulesContainer.innerHTML=`
        <div class="loading" style="
            text-align: center; 
            padding: 60px 20px; 
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        ">
            <div style="font-size: 3em; margin-bottom: 20px; animation: spin 2s linear infinite;">‚ö°</div>
            <div style="font-size: 1.2em; margin-bottom: 10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª —Ç—É—Ä–Ω–∏—Ä–∞</div>
            <div style="font-size: 0.9em; opacity: 0.7;">Illusive Cup 2025</div>
        </div>
    `;fetch("rules.html").then(response=>{if(!response.ok){throw new Error("–§–∞–π–ª –ø—Ä–∞–≤–∏–ª –Ω–µ –Ω–∞–π–¥–µ–Ω")}return response.text()}).then(html=>{const tempDiv=document.createElement("div");tempDiv.innerHTML=html;const rulesBody=tempDiv.querySelector(".container");if(rulesBody){const rulesContent=document.createElement("div");rulesContent.className="rules-content";rulesContent.innerHTML=rulesBody.innerHTML;adaptRulesStyles(rulesContent);rulesContainer.innerHTML="";rulesContainer.appendChild(rulesContent);setTimeout(()=>{rulesContent.style.opacity="0";rulesContent.style.transition="opacity 0.5s ease";rulesContent.style.opacity="1"},100)}else{showRulesError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞")}}).catch(error=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª:",error);showRulesError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`)})}function showRulesError(message){const rulesContainer=document.getElementById("rulesContainer");rulesContainer.innerHTML=`
        <div class="error-container" style="
            text-align: center; 
            padding: 60px 20px; 
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        ">
            <div style="font-size: 4em; margin-bottom: 20px; color: var(--accent-danger);">‚ùå</div>
            <div style="font-size: 1.3em; margin-bottom: 15px; color: var(--text-primary);">${message}</div>
            <button onclick="loadRulesContent()" class="save-btn" style="margin-top: 20px; padding: 12px 24px;">
                üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
            </button>
        </div>
    `}function adaptRulesStyles(rulesContent){const elementsToUpdate=[...rulesContent.querySelectorAll("h1, h2, h3"),...rulesContent.querySelectorAll(".rule-card"),...rulesContent.querySelectorAll(".rule-title"),...rulesContent.querySelectorAll(".warning")];elementsToUpdate.forEach(element=>{element.style.fontFamily="'Exo 2', sans-serif"});const mainTitle=rulesContent.querySelector("h1");if(mainTitle){mainTitle.style.fontFamily="'Orbitron', sans-serif";mainTitle.style.textTransform="uppercase";mainTitle.style.letterSpacing="2px"}}function openRulesModal(){const rulesModal=document.getElementById("rulesModal");if(rulesModal){rulesModal.classList.remove("hidden");document.body.style.overflow="hidden";loadRulesContent();setTimeout(()=>{rulesModal.style.opacity="0";rulesModal.style.transition="opacity 0.3s ease";rulesModal.style.opacity="1"},50)}}function closeRulesModal(){const rulesModal=document.getElementById("rulesModal");if(rulesModal){rulesModal.style.opacity="0";setTimeout(()=>{rulesModal.classList.add("hidden");document.body.style.overflow=""},300)}}function adaptRulesStyles(){const rulesContainer=document.getElementById("rulesContainer");const mainTitle=rulesContainer.querySelector("h1");if(mainTitle){mainTitle.style.fontFamily="'Orbitron', sans-serif";mainTitle.style.textTransform="uppercase";mainTitle.style.letterSpacing="1px"}const ruleCards=rulesContainer.querySelectorAll(".rule-card");ruleCards.forEach(card=>{card.style.fontFamily="'Exo 2', sans-serif"})}function setupRulesButton(){const rulesBtn=document.getElementById("rulesBtn");const rulesContent=document.getElementById("rulesContent");if(rulesBtn&&rulesContent){rulesBtn.addEventListener("click",function(){hideAllContentSections();rulesContent.classList.remove("hidden");loadRulesContent();updateActiveNavButton(this)})}}document.addEventListener("DOMContentLoaded",function(){setupRulesButton()});function adaptRulesStyles(rulesContent){const mainTitle=rulesContent.querySelector("h1");if(mainTitle){mainTitle.style.fontFamily="'Orbitron', sans-serif";mainTitle.style.textTransform="uppercase";mainTitle.style.letterSpacing="1px"}const ruleCards=rulesContent.querySelectorAll(".rule-card");ruleCards.forEach(card=>{card.style.fontFamily="'Exo 2', sans-serif"});const warnings=rulesContent.querySelectorAll(".warning");warnings.forEach(warning=>{warning.style.border="1px solid var(--accent-warning)";warning.style.background="rgba(255, 152, 0, 0.1)"})}function openRulesModal(){const rulesModal=document.getElementById("rulesModal");if(rulesModal){rulesModal.classList.remove("hidden");loadRulesContent()}}function closeRulesModal(){const rulesModal=document.getElementById("rulesModal");if(rulesModal){rulesModal.classList.add("hidden")}}function setupRulesButton(){const rulesBtn=document.getElementById("rulesBtn");const closeRulesModalBtn=document.getElementById("closeRulesModal");if(rulesBtn){rulesBtn.addEventListener("click",openRulesModal)}if(closeRulesModalBtn){closeRulesModalBtn.addEventListener("click",closeRulesModal)}const rulesModal=document.getElementById("rulesModal");if(rulesModal){rulesModal.addEventListener("click",function(event){if(event.target===rulesModal){closeRulesModal()}})}}document.addEventListener("DOMContentLoaded",function(){setupRulesButton()});function hideAllModals(){const modals=document.querySelectorAll(".modal");modals.forEach(modal=>{modal.classList.add("hidden")})}function updateAdminTeamsList(){const container=document.getElementById("adminTeamsList");if(!container||!teamsManager)return;const teams=teamsManager.getAllTeams();container.innerHTML="";Object.keys(teams).forEach(teamId=>{const team=teams[teamId];const teamElement=document.createElement("div");teamElement.className="admin-team-item";teamElement.innerHTML=`
            <div class="team-info">
                <strong>${team.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è"}</strong>
                <span>MMR: ${team.mmr||"0"}</span>
            </div>
            <button class="edit-btn" onclick="editTeam('${teamId}')">‚úèÔ∏è</button>
        `;container.appendChild(teamElement)})}window.editTeam=function(teamId){console.log("‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:",teamId);if(!securityManager||!securityManager.isAuthenticated){console.log("‚ùå –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");if(securityManager){securityManager.showAuthModal()}return}if(!teamsManager)return;const team=teamsManager.getTeam(teamId);if(!team)return;const modal=document.getElementById("editTeamModal");if(!modal)return;appState.currentEditingTeamId=teamId;document.getElementById("editTeamName").value=team.name||"";document.getElementById("editTeamSlogan").value=team.slogan||"";const playersContainer=document.getElementById("playersEditContainer");playersContainer.innerHTML="";const players=team.players||Array(5).fill().map(()=>({name:"",role:"",mmr:3e3}));players.forEach((player,index)=>{const playerElement=document.createElement("div");playerElement.className="player-edit-form";playerElement.innerHTML=`
            <h4>–ò–≥—Ä–æ–∫ ${index+1}</h4>
            <div class="player-fields">
                <input type="text" class="player-name" placeholder="–ù–∏–∫–Ω–µ–π–º" value="${player.name||""}">
                <input type="text" class="player-role" placeholder="–ü–æ–∑–∏—Ü–∏—è" value="${player.role||""}">
                <input type="number" class="player-mmr" placeholder="MMR" value="${player.mmr||3e3}" min="0" max="10000">
            </div>
        `;playersContainer.appendChild(playerElement)});modal.classList.remove("hidden")};window.saveTeamChanges=async function(){console.log("üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–º–∞–Ω–¥—ã");if(!securityManager||!securityManager.isAuthenticated||!teamsManager)return;const teamId=appState.currentEditingTeamId;if(!teamId)return;const name=document.getElementById("editTeamName").value.trim();const slogan=document.getElementById("editTeamSlogan").value.trim();const players=[];const playerForms=document.querySelectorAll(".player-edit-form");playerForms.forEach(form=>{const nameInput=form.querySelector(".player-name");const roleInput=form.querySelector(".player-role");const mmrInput=form.querySelector(".player-mmr");players.push({name:nameInput?.value.trim()||"",role:roleInput?.value.trim()||"",mmr:parseInt(mmrInput?.value)||3e3})});if(!name){alert("‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã");return}const teamData={name:name,slogan:slogan,players:players};try{await teamsManager.updateTeam(teamId,teamData);closeEditTeamModal();alert("‚úÖ –ö–æ–º–∞–Ω–¥–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!")}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã:",error);alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã")}};window.updateTeamsCount=async function(){console.log("üî¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–∞–Ω–¥");if(!securityManager||!securityManager.isAuthenticated||!teamsManager)return;const input=document.getElementById("totalTeams");const count=parseInt(input.value)||4;if(count<2||count>16){alert("‚ùå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 16");return}const currentTeams=teamsManager.getAllTeams();const currentCount=Object.keys(currentTeams).length;try{if(count<currentCount){const teamIds=Object.keys(currentTeams);for(let i=count;i<currentCount;i++){await teamsManager.deleteTeam(teamIds[i])}}else if(count>currentCount){for(let i=currentCount+1;i<=count;i++){const teamId=`team${i}`;const newTeam={name:`–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ ${i}`,slogan:"",players:Array(5).fill().map(()=>({name:"",role:"",mmr:3e3})),mmr:3e3};await teamsManager.createTeam(teamId,newTeam)}}updateAdminTeamsList();alert(`‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–æ: ${count}`)}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥:",error);alert("‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥")}};function setupModalCloseHandlers(){document.addEventListener("click",event=>{if(event.target.classList.contains("modal")){const modalId=event.target.id;if(modalId==="bracketModal"){closeBracketModal()}else if(modalId==="rulesModal"){closeRulesModal()}else if(modalId==="authModal"){securityManager.hideAuthModal()}}});document.addEventListener("keydown",event=>{if(event.key==="Escape"){if(!document.getElementById("bracketModal").classList.contains("hidden")){closeBracketModal()}}})}function showAddMatchModal(){if(!securityManager||!securityManager.isAuthenticated){securityManager.showAuthModal();return}const modal=document.getElementById("addMatchModal");if(!modal)return;populateTeamSelects();const stageSelect=document.getElementById("newMatchStage");if(stageSelect&&tournamentFormatManager){const isGroupFormat=tournamentFormatManager.isGroupFormat();stageSelect.innerHTML=tournamentFormatManager.getStageOptions(isGroupFormat)}modal.classList.remove("hidden")}let bracketLink="";async function initBracketSystem(){try{console.log("üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞–≥–ª—è–¥–Ω–æ–π —Å–µ—Ç–∫–∏...");await loadBracketLink();setupBracketButton();setupBracketAdmin();console.log("‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥–ª—è–¥–Ω–æ–π —Å–µ—Ç–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞")}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —Å–µ—Ç–∫–∏:",error)}}async function loadBracketLink(){return new Promise((resolve,reject)=>{const bracketRef=database.ref("tournament/bracketLink");bracketRef.on("value",snapshot=>{const link=snapshot.val();if(link&&isValidUrl(link)){bracketLink=link;console.log("üéØ –ó–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É:",bracketLink);showBracketButton();updateBracketStatus(true,link)}else{bracketLink="";console.log("üéØ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");hideBracketButton();updateBracketStatus(false,"")}resolve()},error=>{console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–µ—Ç–∫—É:",error);bracketLink="";hideBracketButton();updateBracketStatus(false,"");reject(error)})})}function showBracketButton(){const bracketNavItem=document.getElementById("bracketNavItem");if(bracketNavItem){bracketNavItem.style.display="block";setTimeout(()=>{bracketNavItem.style.opacity="0";bracketNavItem.style.transition="opacity 0.5s ease";bracketNavItem.style.opacity="1"},100)}}function hideBracketButton(){const bracketNavItem=document.getElementById("bracketNavItem");if(bracketNavItem){bracketNavItem.style.display="none"}}function updateBracketStatus(isActive,link){const statusElement=document.getElementById("bracketStatus");const statusText=document.getElementById("bracketStatusText");const currentLink=document.getElementById("currentBracketLink");if(statusElement&&statusText&&currentLink){if(isActive&&link){statusText.textContent="–°—Å—ã–ª–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞";statusText.style.color="var(--accent-success)";currentLink.textContent=link;statusElement.style.display="block"}else{statusText.textContent="–°—Å—ã–ª–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞";statusText.style.color="var(--accent-danger)";currentLink.textContent="–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞";statusElement.style.display="block"}}}function setupBracketButton(){const bracketBtn=document.getElementById("bracketBtn");const closeBracketModalBtn=document.getElementById("closeBracketModal");if(bracketBtn){bracketBtn.addEventListener("click",openBracketModal)}if(closeBracketModalBtn){closeBracketModalBtn.addEventListener("click",closeBracketModal)}const bracketModal=document.getElementById("bracketModal");if(bracketModal){bracketModal.addEventListener("click",function(event){if(event.target===bracketModal){closeBracketModal()}})}}function setupBracketAdmin(){const saveBracketLink=document.getElementById("saveBracketLink");const clearBracketLink=document.getElementById("clearBracketLink");const bracketLinkInput=document.getElementById("bracketLink");if(saveBracketLink){saveBracketLink.addEventListener("click",saveBracketLinkHandler)}if(clearBracketLink){clearBracketLink.addEventListener("click",clearBracketLinkHandler)}if(bracketLinkInput&&bracketLink){bracketLinkInput.value=bracketLink}}function saveBracketLinkHandler(){const bracketLinkInput=document.getElementById("bracketLink");const link=bracketLinkInput.value.trim();if(!link){alert("‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å–µ—Ç–∫—É!");return}if(!isValidUrl(link)){alert("‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—Å—ã–ª–∫—É!");return}const bracketRef=database.ref("tournament/bracketLink");bracketRef.set(link).then(()=>{console.log("‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:",link);alert("‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!");bracketLink=link;showBracketButton();updateBracketStatus(true,link)}).catch(error=>{console.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏:",error);alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏!")})}function clearBracketLinkHandler(){if(!confirm("üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–∞–≥–ª—è–¥–Ω—É—é —Å–µ—Ç–∫—É?")){return}const bracketRef=database.ref("tournament/bracketLink");bracketRef.remove().then(()=>{console.log("‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É —É–¥–∞–ª–µ–Ω–∞");alert("‚úÖ –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É —É–¥–∞–ª–µ–Ω–∞!");bracketLink="";const bracketLinkInput=document.getElementById("bracketLink");if(bracketLinkInput){bracketLinkInput.value=""}hideBracketButton();updateBracketStatus(false,"")}).catch(error=>{console.error("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏:",error);alert("‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏!")})}function isValidUrl(string){try{new URL(string);return true}catch(_){return false}}function openBracketModal(){if(!bracketLink){alert("‚ùå –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!");return}const bracketModal=document.getElementById("bracketModal");const bracketContainer=document.getElementById("bracketContainer");if(bracketModal&&bracketContainer){bracketModal.classList.remove("hidden");document.body.style.overflow="hidden";bracketContainer.innerHTML=`
            <div class="bracket-security-notice">
                <p>‚ö†Ô∏è –ï—Å–ª–∏ —Å–µ—Ç–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –æ—Ç–∫–ª—é—á–∏—Ç–µ AdBlocker –¥–ª—è LVUP.GG –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ"</p>
            </div>
            <iframe src="${bracketLink}" 
                    class="bracket-iframe"
                    sandbox="allow-scripts allow-same-origin allow-popups allow-forms"
                    allow="fullscreen"
                    referrerpolicy="no-referrer-when-downgrade"
                    title="–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ Illusive Cup 2025">
            </iframe>
        `;setTimeout(()=>{bracketModal.style.opacity="0";bracketModal.style.transition="opacity 0.3s ease";bracketModal.style.opacity="1"},50)}}function closeBracketModal(){const bracketModal=document.getElementById("bracketModal");if(bracketModal){bracketModal.style.opacity="0";setTimeout(()=>{bracketModal.classList.add("hidden");document.body.style.overflow="";const bracketContainer=document.getElementById("bracketContainer");if(bracketContainer){bracketContainer.innerHTML=`
                    <div class="bracket-loading">
                        <div class="loading-spinner">‚ö°</div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Å–µ—Ç–∫–∏...</p>
                    </div>
                `}},300)}}function openBracketInNewTab(){if(bracketLink){window.open(bracketLink,"_blank")}}function openBracketFullscreen(){if(!bracketLink){alert("‚ùå –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!");return}const fullscreenContainer=document.createElement("div");fullscreenContainer.className="bracket-fullscreen";fullscreenContainer.innerHTML=`
        <div class="bracket-fullscreen-header">
            <h3>üéØ –¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞ - Illusive Cup 2025</h3>
            <button class="close-fullscreen" onclick="closeBracketFullscreen()">√ó</button>
        </div>
        <iframe src="${bracketLink}" 
                class="bracket-fullscreen-iframe" 
                allowfullscreen
                title="–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Å–µ—Ç–∫–∞">
        </iframe>
    `;fullscreenContainer.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: white;
        z-index: 10000;
        display: flex;
        flex-direction: column;
    `;document.body.appendChild(fullscreenContainer);document.body.style.overflow="hidden"}function closeBracketFullscreen(){const fullscreen=document.querySelector(".bracket-fullscreen");if(fullscreen){fullscreen.remove();document.body.style.overflow=""}}function populateTeamSelects(){const team1Select=document.getElementById("newMatchTeam1");const team2Select=document.getElementById("newMatchTeam2");if(!team1Select||!team2Select||!teamsManager)return;team1Select.innerHTML='<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É --</option>';team2Select.innerHTML='<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É --</option>';const teams=teamsManager.getAllTeams(true);Object.keys(teams).forEach(teamId=>{const team=teams[teamId];const option1=document.createElement("option");const option2=document.createElement("option");option1.value=teamId;option1.textContent=team.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";if(teamsManager.isTeamHidden(teamId)){option1.textContent+=" ‚è≥"}option2.value=teamId;option2.textContent=team.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";if(teamsManager.isTeamHidden(teamId)){option2.textContent+=" ‚è≥"}team1Select.appendChild(option1);team2Select.appendChild(option2)})}async function saveNewMatch(){const team1Select=document.getElementById("newMatchTeam1");const team2Select=document.getElementById("newMatchTeam2");const timeInput=document.getElementById("newMatchTime");const stageSelect=document.getElementById("newMatchStage");const formatSelect=document.getElementById("newMatchFormat");if(!team1Select||!team2Select||!timeInput||!stageSelect||!matchManager)return;const team1Id=team1Select.value;const team2Id=team2Select.value;const time=timeInput.value;const stage=stageSelect.value;const format=formatSelect?formatSelect.value:"bo1";if(!team1Id||!team2Id){alert("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–µ –∫–æ–º–∞–Ω–¥—ã");return}if(team1Id===team2Id){alert("‚ùå –ö–æ–º–∞–Ω–¥—ã –Ω–µ –º–æ–≥—É—Ç –∏–≥—Ä–∞—Ç—å —Å–∞–º–∏ —Å —Å–æ–±–æ–π");return}if(!time){alert("‚ùå –£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –º–∞—Ç—á–∞");return}const teams=teamsManager.getAllTeams();const team1Name=teams[team1Id]?.name||"–ö–æ–º–∞–Ω–¥–∞ 1";const team2Name=teams[team2Id]?.name||"–ö–æ–º–∞–Ω–¥–∞ 2";const matchTime=new Date(time).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});const matchData={team1Id:team1Id,team2Id:team2Id,team1Name:team1Name,team2Name:team2Name,time:matchTime,timestamp:new Date(time).getTime(),stage:stage,format:format,score1:0,score2:0,createdAt:Date.now()};try{await matchManager.createMatch(matchData);closeAddMatchModal();alert("‚úÖ –ú–∞—Ç—á —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!")}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞:",error);alert("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ç—á–∞")}}function closeAddMatchModal(){const modal=document.getElementById("addMatchModal");if(modal){modal.classList.add("hidden");const team1Select=document.getElementById("newMatchTeam1");const team2Select=document.getElementById("newMatchTeam2");const timeInput=document.getElementById("newMatchTime");const stageSelect=document.getElementById("newMatchStage");const formatSelect=document.getElementById("newMatchFormat");if(team1Select)team1Select.value="";if(team2Select)team2Select.value="";if(timeInput)timeInput.value="";if(stageSelect)stageSelect.value="group";if(formatSelect)formatSelect.value="bo1"}}function setupMatchEditing(){document.addEventListener("click",e=>{const matchCard=e.target.closest(".match-card, .double-elimination-match");if(matchCard){const matchId=matchCard.getAttribute("data-match-id");if(matchId){const match=matchManager.getMatch(matchId);const teams=teamsManager?teamsManager.getAllTeams(true):{};const team1Exists=teams[match.team1Id]&&teams[match.team1Id].name;const team2Exists=teams[match.team2Id]&&teams[match.team2Id].name;const isHiddenTeam1=teamsManager.isTeamHidden(match.team1Id);const isHiddenTeam2=teamsManager.isTeamHidden(match.team2Id);if(!team1Exists||!team2Exists){if(securityManager&&securityManager.isAuthenticated&&confirm("üóëÔ∏è –≠—Ç–æ—Ç –º–∞—Ç—á —Å–æ–¥–µ—Ä–∂–∏—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã. –•–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç—á?")){matchManager.deleteMatch(matchId)}}else{if(securityManager&&securityManager.isAuthenticated){showEditMatchTimeModal(matchId)}}}}})}function updateConnectionStatus(connected){const status=document.getElementById("connectionStatus");if(!status)return;const isAuthorized=securityManager&&securityManager.isAuthenticated;if(!isAuthorized){status.classList.add("hidden");return}const dot=status.querySelector(".status-dot");const text=status.querySelector(".status-text");if(connected){status.classList.remove("hidden");if(dot)dot.classList.add("connected");if(text)text.textContent="–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Ç—É—Ä–Ω–∏—Ä—É"}else{status.classList.remove("hidden");if(dot)dot.classList.remove("connected");if(text)text.textContent="–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"}}window.createDoubleEliminationBracket=function(){if(!securityManager||!securityManager.isAuthenticated){securityManager.showAuthModal();return}if(matchManager&&matchManager.createDoubleEliminationBracket){matchManager.createDoubleEliminationBracket()}};async function initializeApp(){try{console.log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Tournament App...");if(!window.ADMIN_CONFIG){throw new Error("‚ùå admin-config.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω!")}const firebaseConfig=window.ADMIN_CONFIG.firebaseConfig;if(!firebaseConfig||!firebaseConfig.projectId){throw new Error("‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π firebaseConfig –≤ admin-config.js")}firebase.initializeApp(firebaseConfig);database=firebase.database();window.database=database;console.log("üî• Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");await window.HiddenTeamsManager.initialize(database);securityManager=new SecurityManager;teamsManager=new TeamsManager(database);tournamentFormatManager=new TournamentFormatManager(database);matchManager=new MatchManager(database);votingSystem=new VotingSystem(database);await teamsManager.initialize();await tournamentFormatManager.initialize();await matchManager.initialize();await votingSystem.initialize();await initBracketSystem();setupEventListeners();setupDeleteTeamHandler();setupMatchEditing();securityManager.init();updateConnectionStatus(true);populateVoteMatchSelect();updateAudienceAwardsDisplay();console.log("‚úÖ Tournament App —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:");const components={teamsManager:!!teamsManager,matchManager:!!matchManager,tournamentFormatManager:!!tournamentFormatManager,votingSystem:!!votingSystem,securityManager:!!securityManager,bracketLink:!!bracketLink};console.log("üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:",components);console.log("üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥:",Object.keys(teamsManager.getAllTeams()).length);console.log("üéØ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ç—á–µ–π (–±–µ–∑ –≥—Ä—É–ø–ø—ã):",Object.keys(matchManager.noGroupMatches).length);console.log("üìã –§–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞:",tournamentFormatManager.getCurrentFormat());console.log("üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ç–∫—É:",bracketLink||"–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");const uiElements={navigation:!!document.querySelector(".navigation-grid"),contentArea:!!document.querySelector(".content-area"),adminBtn:!!document.getElementById("adminBtn"),bracketBtn:!!document.getElementById("bracketBtn")};if(window.holidayTheme){console.log("üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è —Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞")}else{console.log("‚ö†Ô∏è –ù–æ–≤–æ–≥–æ–¥–Ω—è—è —Ç–µ–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")}}catch(error){console.error("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:",error)}}function setupDeleteTeamHandler(){const deleteBtn=document.getElementById("deleteTeamBtn");if(deleteBtn){deleteBtn.addEventListener("click",async()=>{const teamId=appState.currentEditingTeamId;if(teamId&&teamsManager){await teamsManager.deleteTeam(teamId)}})}}function setupEventListeners(){console.log("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...");const teamsDropdownBtn=document.getElementById("teamsDropdownBtn");const scheduleBtn=document.getElementById("scheduleBtn");const groupStageBtn=document.getElementById("groupStageBtn");const playoffBtn=document.getElementById("playoffBtn");const audienceAwardBtn=document.getElementById("audienceAwardBtn");const scheduleNoGroupBtn=document.getElementById("scheduleNoGroupBtn");const playoffGridBtn=document.getElementById("playoffGridBtn");if(teamsDropdownBtn){teamsDropdownBtn.addEventListener("click",toggleDropdown)}if(scheduleBtn){scheduleBtn.addEventListener("click",()=>showSection("schedule"))}if(groupStageBtn){groupStageBtn.addEventListener("click",()=>showSection("groupStage"))}if(playoffBtn){playoffBtn.addEventListener("click",()=>showSection("playoff"))}if(audienceAwardBtn){audienceAwardBtn.addEventListener("click",()=>showSection("audienceAward"))}if(scheduleNoGroupBtn){scheduleNoGroupBtn.addEventListener("click",()=>{showSection("scheduleNoGroup");if(matchManager&&matchManager.updateMatchUI){matchManager.updateMatchUI()}})}if(playoffGridBtn){playoffGridBtn.addEventListener("click",()=>{showSection("playoffGrid")})}const closeEditTeamModalBtn=document.getElementById("closeEditTeamModal");const cancelEditTeamBtn=document.getElementById("cancelEditTeamBtn");if(closeEditTeamModalBtn){closeEditTeamModalBtn.addEventListener("click",closeEditTeamModal)}if(cancelEditTeamBtn){cancelEditTeamBtn.addEventListener("click",closeEditTeamModal)}document.querySelectorAll(".tab-btn").forEach(btn=>{btn.addEventListener("click",function(){openAdminTab(this.getAttribute("data-tab"))})});const saveTeamBtn=document.getElementById("saveTeamBtn");const applyTeamsCountBtn=document.getElementById("applyTeamsCountBtn");if(saveTeamBtn){saveTeamBtn.addEventListener("click",window.saveTeamChanges)}if(applyTeamsCountBtn){applyTeamsCountBtn.addEventListener("click",window.updateTeamsCount)}const addScheduleMatchBtn=document.getElementById("addScheduleMatchBtn");const addRPOFMatchBtn=document.getElementById("addRPOFMatchBtn");const saveNewMatchBtn=document.getElementById("saveNewMatchBtn");const cancelAddMatchBtn=document.getElementById("cancelAddMatchBtn");const closeAddMatchModal=document.getElementById("closeAddMatchModal");if(addScheduleMatchBtn){addScheduleMatchBtn.addEventListener("click",showAddMatchModal)}if(addRPOFMatchBtn){addRPOFMatchBtn.addEventListener("click",showAddMatchModal)}if(saveNewMatchBtn){saveNewMatchBtn.addEventListener("click",saveNewMatch)}if(cancelAddMatchBtn){cancelAddMatchBtn.addEventListener("click",closeAddMatchModal)}if(closeAddMatchModal){closeAddMatchModal.addEventListener("click",closeAddMatchModal)}const saveMatchResultBtn=document.getElementById("saveMatchResultBtn");const cancelEditMatchResultBtn=document.getElementById("cancelEditMatchResultBtn");const closeEditMatchResultModal=document.getElementById("closeEditMatchResultModal");const deleteMatchBtn=document.getElementById("deleteMatchBtn");if(saveMatchResultBtn){saveMatchResultBtn.addEventListener("click",saveMatchResultWithTime)}if(cancelEditMatchResultBtn){cancelEditMatchResultBtn.addEventListener("click",closeEditMatchResultModal)}if(closeEditMatchResultModal){closeEditMatchResultModal.addEventListener("click",closeEditMatchResultModal)}if(deleteMatchBtn){deleteMatchBtn.addEventListener("click",function(){const matchId=appState.currentEditingMatchId;if(matchId){window.deleteMatch(matchId)}})}const selectMatchForVote=document.getElementById("selectMatchForVote");const closeVotingModal=document.getElementById("closeVotingModal");const cancelVote=document.getElementById("cancelVote");const submitVoteBtn=document.getElementById("submitVote");const closeEditVoteModal=document.getElementById("closeEditVoteModal");const closeEditVoteBtn=document.getElementById("closeEditVoteBtn");if(selectMatchForVote){selectMatchForVote.addEventListener("click",function(){const matchSelect=document.getElementById("voteMatchSelect");const selectedMatchId=matchSelect.value;if(!selectedMatchId){alert("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è");return}showVotingModal(selectedMatchId)})}if(closeVotingModal){closeVotingModal.addEventListener("click",closeVotingModal)}if(cancelVote){cancelVote.addEventListener("click",closeVotingModal)}if(submitVoteBtn){submitVoteBtn.addEventListener("click",submitVote)}if(closeEditVoteModal){closeEditVoteModal.addEventListener("click",closeEditVoteModal)}if(closeEditVoteBtn){closeEditVoteBtn.addEventListener("click",closeEditVoteModal)}const saveTournamentFormatBtn=document.getElementById("saveTournamentFormat");if(saveTournamentFormatBtn){saveTournamentFormatBtn.addEventListener("click",async()=>{const formatSelect=document.getElementById("tournamentFormat");if(formatSelect&&tournamentFormatManager){const newFormat=formatSelect.value;const success=await tournamentFormatManager.setTournamentFormat(newFormat);if(success){alert("‚úÖ –§–æ—Ä–º–∞—Ç —Ç—É—Ä–Ω–∏—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!")}else{alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç—É—Ä–Ω–∏—Ä–∞")}}})}const createDoubleEliminationBtn=document.getElementById("createDoubleEliminationBtn");if(createDoubleEliminationBtn){createDoubleEliminationBtn.addEventListener("click",window.createDoubleEliminationBracket)}document.addEventListener("click",event=>{if(event.target.classList.contains("modal")){event.target.classList.add("hidden")}if(!event.target.closest(".dropdown")&&!event.target.closest(".nav-btn")){closeAllDropdowns()}});document.addEventListener("keydown",event=>{if(event.key==="Escape"){closeAllModals()}});console.log("‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã");const saveBracketLink=document.getElementById("saveBracketLink");const clearBracketLink=document.getElementById("clearBracketLink");const bracketBtn=document.getElementById("bracketBtn");const closeBracketModal=document.getElementById("closeBracketModal");if(saveBracketLink){saveBracketLink.addEventListener("click",saveBracketLinkHandler)}if(clearBracketLink){clearBracketLink.addEventListener("click",clearBracketLinkHandler)}if(bracketBtn){bracketBtn.addEventListener("click",openBracketModal)}if(closeBracketModal){closeBracketModal.addEventListener("click",closeBracketModal)}const feedbackBtn=document.getElementById("feedbackBtn");const closeFeedbackModal=document.getElementById("closeFeedbackModal");const feedbackModal=document.getElementById("feedbackModal");if(feedbackBtn){feedbackBtn.addEventListener("click",openFeedbackModal)}if(closeFeedbackModal){closeFeedbackModal.addEventListener("click",closeFeedbackModalFunc)}if(feedbackModal){feedbackModal.addEventListener("click",function(event){if(event.target===feedbackModal){closeFeedbackModalFunc()}})}function openFeedbackModal(){const modal=document.getElementById("feedbackModal");if(modal){modal.classList.remove("hidden");setTimeout(()=>{modal.style.opacity="0";modal.style.transition="opacity 0.3s ease";modal.style.opacity="1"},50)}}function closeFeedbackModalFunc(){const modal=document.getElementById("feedbackModal");if(modal){modal.style.opacity="0";setTimeout(()=>{modal.classList.add("hidden")},300)}}document.addEventListener("keydown",function(event){if(event.key==="Escape"){const feedbackModal=document.getElementById("feedbackModal");if(feedbackModal&&!feedbackModal.classList.contains("hidden")){closeFeedbackModalFunc()}}})}function createAnimatedBackground(){const bg=document.getElementById("animatedBg");if(!bg)return;for(let i=0;i<20;i++){const particle=document.createElement("div");particle.className="particle";const size=Math.random()*100+50;const left=Math.random()*100;const animationDuration=Math.random()*30+20;const animationDelay=Math.random()*10;particle.style.width=`${size}px`;particle.style.height=`${size}px`;particle.style.left=`${left}%`;particle.style.animationDuration=`${animationDuration}s`;particle.style.animationDelay=`${animationDelay}s`;bg.appendChild(particle)}}document.addEventListener("DOMContentLoaded",function(){console.log("üìÑ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...");createAnimatedBackground();initializeApp()});function setupHolidayThemeToggle(){console.log("üéÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–π —Ç–µ–º—ã...");const themeToggle=document.getElementById("holidayThemeToggle");const themeStatus=document.getElementById("themeStatus");const themeStatusText=document.getElementById("themeStatusText");if(themeToggle&&database){const themeRef=database.ref("systemSettings/holidayThemeEnabled");themeRef.on("value",snapshot=>{const isEnabled=snapshot.val()||false;themeToggle.checked=isEnabled;if(themeStatus){themeStatus.style.display="block"}if(themeStatusText){themeStatusText.textContent=isEnabled?"–¢–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞ üéÑ":"–¢–µ–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞";themeStatusText.style.color=isEnabled?"var(--accent-success)":"var(--accent-danger)"}console.log("üéÑ –°—Ç–∞—Ç—É—Å —Ç–µ–º—ã:",isEnabled)});themeToggle.addEventListener("change",function(){const isEnabled=this.checked;themeRef.set(isEnabled).then(()=>{console.log("üéÑ Theme state updated:",isEnabled);if(themeStatusText){themeStatusText.textContent=isEnabled?"–¢–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞ üéÑ":"–¢–µ–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞";themeStatusText.style.color=isEnabled?"var(--accent-success)":"var(--accent-danger)"}showNotification(isEnabled?"üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è —Ç–µ–º–∞ –≤–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!":"‚ùÑÔ∏è –ù–æ–≤–æ–≥–æ–¥–Ω—è—è —Ç–µ–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞")}).catch(error=>{console.error("‚ùå Error updating theme:",error);showNotification("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–º—ã","error")})});console.log("‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω")}else{console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã –∏–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")}}function showNotification(message,type="success"){const notification=document.createElement("div");notification.className=`notification ${type}`;notification.innerHTML=`
        <div class="notification-content">
            <span class="notification-icon">${type==="success"?"‚úÖ":"‚ùå"}</span>
            <span class="notification-text">${message}</span>
        </div>
    `;notification.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type==="success"?"var(--accent-success)":"var(--accent-danger)"};
        color: white;
        padding: 12px 20px;
        border-radius: var(--radius-medium);
        z-index: 10001;
        box-shadow: var(--shadow-medium);
        animation: slideIn 0.3s ease;
        font-family: 'Exo 2', sans-serif;
        font-size: 14px;
    `;document.body.appendChild(notification);setTimeout(()=>{notification.style.animation="slideOut 0.3s ease";setTimeout(()=>{if(notification.parentNode){notification.parentNode.removeChild(notification)}},300)},3e3)}const notificationStyles=`
@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(100%); opacity: 0; }
}
`;const style=document.createElement("style");style.textContent=notificationStyles;document.head.appendChild(style);